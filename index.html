<!DOCTYPE html>
<html ng-app=stripeApp>
<head>
	<title>stripe test</title>
</head>
<body ng-controller="AppController">
	<h1>STRIPE TEST</h1>
	<button ng-click="payment($event)">pay with stripe</button>
	<h3>Thx 4 pay!!</h3>
	
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.js"></script>
	<script src="https://checkout.stripe.com/checkout.js"></script>
	<script>
		angular
		.module('stripeApp', [])
		.controller('AppController', ['$scope', '$http', '$q', function ($scope, $http, $q) {

			$scope.paymentDetails = {
				name: 'NAME',
				description: 'DESCRIPTION',
				amount: '888'
			};
			var handler = StripeCheckout.configure({
				  key: 'pk_test_x5UrUcpDMTQcqHosJ78sibQf',
				  locale: 'auto',
				  token: function (token) {
				  	$http.post('/charge', { token: token, paymentDetails: $scope.paymentDetails })
				  	.success(function (ok) {
				  		console.log('ok = ', ok);
				  	})
				  	.error(function (err) {
				  		console.log(err);
				  	})
				  }
				});

			$scope.payment = function (e) {
				handler.open($scope.paymentDetails);
				e.preventDefault();
			};

			window.onpopstate = function (event) {
				handler.close();
			}
			
		}]);
	</script>
</body>
</html>
